<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klaviyo Analytics Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Klaviyo Analytics Dashboard</h1>
        <div class="alert alert-info">
            <h4>Welcome</h4>
            <p>Upload your Klaviyo CSV to instantly view insights across Daily, Weekly, Monthly, Trend, Growth, and Seasonal tabs. Optionally filter by date range and click "Filter Data" to refine results. For best results, run using a local server (e.g., <code>python -m http.server</code>) or deploy to a hosting platform like Netlify. Note: This app requires an internet connection for library loading.</p>
        </div>
        <div class="form-group">
            <label for="csvUpload">Upload Klaviyo CSV:</label>
            <input type="file" id="csvUpload" class="form-control-file" accept=".csv">
        </div>
        <div id="loadingIndicator" class="alert alert-warning" style="display: none;">
            <p>Loading CSV data, please wait...</p>
        </div>
        <div class="form-group">
            <label for="startDate">Start Date (Optional):</label>
            <input type="date" id="startDate" class="form-control">
        </div>
        <div class="form-group">
            <label for="endDate">End Date (Optional):</label>
            <input type="date" id="endDate" class="form-control">
        </div>
        <button id="filterButton" class="btn btn-primary">Filter Data</button>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="daily-tab" data-toggle="tab" href="#daily" role="tab">Daily Tracking</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="weekly-tab" data-toggle="tab" href="#weekly" role="tab">Weekly Tracking</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="monthly-tab" data-toggle="tab" href="#monthly" role="tab">Monthly Tracking</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="trend-tab" data-toggle="tab" href="#trend" role="tab">Trend Analysis</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="growth-tab" data-toggle="tab" href="#growth" role="tab">Growth Insights</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="seasonal-tab" data-toggle="tab" href="#seasonal" role="tab">Seasonal Patterns</a>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="daily" role="tabpanel">
                <div id="dailyTable"></div>
            </div>
            <div class="tab-pane fade" id="weekly" role="tabpanel">
                <div id="weeklyTable"></div>
            </div>
            <div class="tab-pane fade" id="monthly" role="tabpanel">
                <div id="monthlyTable"></div>
            </div>
            <div class="tab-pane fade" id="trend" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <canvas id="trendChart"></canvas>
                    </div>
                    <div class="col-md-6" id="trendTable"></div>
                </div>
            </div>
            <div class="tab-pane fade" id="growth" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <canvas id="growthChart"></canvas>
                    </div>
                    <div class="col-md-6" id="growthTable"></div>
                </div>
            </div>
            <div class="tab-pane fade" id="seasonal" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <canvas id="seasonalChart"></canvas>
                    </div>
                    <div class="col-md-6" id="seasonalTable"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="app.js"></script>
</body>
</html>